<html>

<head>
    <meta name="viewport" content="width=device-width">
    <script src=''></script>
</head>


<style>
    #todo {
        background: white;
        overflow: auto;
        width: 100%;
        height: 100%;
        padding: 5px;
    }
    .cd {
        text-align: center;
        margin: 5px;
        border-style: double;
        border-radius: 3px;
        padding: 5px;
    }
    .ct {
        font-size: 20px;
        color: white;
        font-weight: bold;
        background: black;
        border-radius: 10px;
        text-align: center;
        padding: 5px;
        width: 95%;
    }
    .ca {
        margin: 10px;
        padding: 10px;
        border: solid;
        width: 90%;
        height: 35%;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.034), 0 6.7px 5.3px rgba(0, 0, 0, 0.048), 0 12.5px 10px rgba(0, 0, 0, 0.06), 0 22.3px 17.9px rgba(0, 0, 0, 0.072), 0 41.8px 33.4px rgba(0, 0, 0, 0.086), 0 100px 80px rgba(0, 0, 0, 0.12);
    }
    #plus {
        position: absolute;
        top: 2%;
        right: 4%;
        color: white;
        background: red;
        width: 25px;
        height: 25px;
        border-radius: 100px;
        font-weight: bold;
        font-size: 20px;
    }  
    #btoweb {
        position: absolute;
        top: 2%;
        left: 4%;
        color: white;
        background: orange;
 
        border-radius: 100px;
        font-weight: bold;
        font-size: 14px;
    }
    .cbd {
        margin: 15px;
    }
    .cse {
        margin: 15px;
        width: 80%;;
        background-color: cornsilk;
        border-radius: 100px;
    }
    .cm {
        width: 90%;
        border-radius: 100px;
        font-size: 24px;
    }
    #temp{
         background-color: cornsilk;
        position: absolute;
        width: 60%;;
        height: 20%;
        top:30%;
        left: 20%;
        display: none;
        padding: 10px;
        border-style:double;
        border-radius:8px;
        font-weight:bold;
        
        box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.034), 0 6.7px 5.3px rgba(0, 0, 0, 0.048), 0 12.5px 10px rgba(0, 0, 0, 0.06), 0 22.3px 17.9px rgba(0, 0, 0, 0.072), 0 41.8px 33.4px rgba(0, 0, 0, 0.086), 0 100px 80px rgba(0, 0, 0, 0.12);
       opacity:.85;
    }
    
</style>

<div id="todo">

</div>
<textarea id="temp" value=""></textarea>
<button id="btoweb" onclick="wetNotas()">Web</button>
<button id="plus" onclick="crBlankNota()">+</button>

<script>
var li=localStorage.getItem("link");
var localtrash=localStorage.getItem("notastrash");


    //   app.TextToSpeech( "DroidScript is awesome!", 1.0, 1.0 );
    var speechRecognizer;
    if ("window.SpeechRecognition" in window || "webkitSpeechRecognition" in window) {
        speechRecognizer = new webkitSpeechRecognition();
        speechRecognizer.continuous = false;
        speechRecognizer.interimResults = true;
        speechRecognizer.lang = "es-MX | en-US";
        speechRecognizer.maxAlternatives = 1;
    } else {
        alert("your browser does not support speech recognition")
    }

    var active = false;
    var notas;
    //localStorage.removeItem("notas")
    var ns = localStorage.getItem("notas");

    if (ns != null) notas = JSON.parse(ns)
    else notas = [{
        name: "",
        nota: "",
        fe: "",
        st: {
            status: "blank"
        }
    }];
    if (notas[notas.length - 1].nota != "") notas.push({
        name: "",
        nota: "",
        fe: (new Date()).toISOString().replace(/T/g, ", Time: ").replace(/Z/g, ""),
        st: {
            status: "blank"
        }
    })
    //  alert(JSON.stringify(notas));

    setUpNotas();

    function setUpNotas() {

        for (var i = 0; i < notas.length; i++) {
            var d = crNota(notas[i]);
            todo.appendChild(d);

        }

    }

    function getNotas() {


    }

    function saveNotas() {
        localStorage.setItem("notas", JSON.stringify(notas));
    }

    function setSt(s) {
        var v = s.value;
        if (v === "delete") {
            if (confirm("Are you sure you want to delete this note?")) {
                var i = s.parentNode.nota;
                //   alert(notas.indexOf(i))
                notas.splice(notas.indexOf(i), 1)
                todo.removeChild(s.parentNode);
                var o=[];
                if(localtrash!=null) o=JSON.parse(localtrash);
                o.push(i);
                
                
                localStorage.setItem("notastrash",JSON.stringify(o));
                alert(JSON.stringify(localStorage.getItem("notastrash")));
            
                }

        }
                if (v === "pShow Trash") {
           // s.parentNode.style.background = "#ccffcc";
        }
        if (v === "pending") {
            s.parentNode.style.background = "#ccffcc";
        }
        if (v === "coming") {
            s.parentNode.style.background = "#ccccff";
        }
        if (v === "done") {
            s.parentNode.style.background = "#ffcccc";
        }
        s.parentNode.nota.st.status = v;

        saveNotas();
    }

    function updateStatus(d) {
        v = d.nota.st.status;
        if (v === "pending") {
            d.style.background = "#ccffcc";
        }
        if (v === "coming") {
            d.style.background = "#ccccff";
        }
        if (v === "done") {
            d.style.background = "#ffcccc";
        }


        
    }

    function crBlankNota() {
        var nn = {
            name: "",
            nota: "",
            fe: (new Date()).toISOString().replace(/T/g, ", Time: ").replace(/Z/g, ""),
            st: {
                status: "blank"
            }
        }
        //  notas.push(nn);
        todo.appendChild(crNota(nn))

    }

    function crNota(n) {
        var d = document.createElement('div');
        d.nota = n;
        d.name = JSON.stringify(n);
        d.setAttribute("class", "cd");


        var se = document.createElement('select');
        se.setAttribute("class", "cse");

        se.setAttribute("oninput", 'setSt(this)');
        se.innerHTML = "<option>blank</option>" +
            "<option>pending</option>" +
            "<option>done</option>" +
            "<option>coming</option>" +
            "<option>Show Trash</option>" +
            "<option>delete</option>";
        if (n.st.status == "") n.st.status = "blank";
        se.value = n.st.status;
        d.appendChild(se);
        updateStatus(d);

        t = document.createElement('p');

        t.innerHTML = n.fe;
        a = document.createElement('textarea');
        t.setAttribute("class", "ct");
        t.setAttribute("onclick", 'speak(this)');
        a.value = n.nota;
        a.oninput = function() {
            active = true
        }
        a.onblur = function() {
            n.nota = this.value;
            active = false;
            saveNotas();
            // alert("Nota has been saved...");
        }
        d.appendChild(t);
        d.appendChild(a);
        var m = document.createElement("button");
        m.innerHTML = "&#127908;"
        m.style.background = "0f0";
        m.style.background = "#0f0";
        m.st = false;
        m.setAttribute("onclick", 'inicRec(this)');
        m.setAttribute("class", "cm");


        d.appendChild(m);
        a.setAttribute("class", "ca");


        return d;

    }

    function getFecha(fe) {

        var fe = fe.split("-");
        var nd = new Date(fe);
        nd.setFullYear(fe[0] * 1);
        nd.setMonth(fe[1] * 1 - 1); // alert(fe[1])
        nd.setDate(fe[2] * 1);
        var nf = nd.getDay();
        var rr = {
            fecha: m[fe[1] * 1 - 1] + " " + fe[2] * 1 + " " + fe[0] * 1 + " (" + dias[nf * 1] + ")",
            color: mc[fe[1] * 1 - 1]
        };

        return rr;
    }


    function inicRec(e) {
        //  alert(e.style.background);alert(e.st);
        var a = e.parentNode.getElementsByTagName("textarea")[0];
        if (!e.st) {
            e.style.background = "rgb(250,0,0)";
            e.st = true;
            startvoice(a);
        } else {
            e.style.background = "rgb(0,250,0)";
            e.st = false;
            a.onblur()
            try {
                speechRecognizer.stop();
            } catch (ee) {
                alert(ee)
            }

        }



    }

    function startvoice(a) {
        // var a=e.parentNode.getElementsByTagName("textarea")[0];
        var b = a.parentNode.getElementsByTagName("button")[0];

        try {

            speechRecognizer.start();
            var ac = "",
                rep = 0;
            var finalTranscripts = "";
            speechRecognizer.onspeechend = function() {
                b.style.background = "#f00";
                temp.style.display="none";
                setTimeout(function() {
                    if (b.st) { //alert('onspeechend')

                        if (ac != "") {

                            ac = ac.charAt(0).toUpperCase() + ac.slice(1)
                            a.value += ac + ". ";
                            ac = a.value;
                            ac = "";

                        }
                        bexcomando = false;
                        //     speechRecognizer.start();

                    } else {
                        speechRecognizer.stop();
                        b.style.background = "#0f0"
                    }
                }, 10)
            }

            speechRecognizer.onend = function() {
                b.style.background = "#0f0";
                temp.style.display="none";
                setTimeout(function() {
                    if (b.st) {
                        rep++;

                        if (rep > 2) {
                            a.value += "\n\n";
                            rep = 0;
                        }
                        ac = "";
                        bexcomando = false;
                        speechRecognizer.start();
                        b.style.background = "#f00";
                        temp.style.display="none";


                    } else {
                        temp.style.display="none";
                        speechRecognizer.stop();
                        b.style.background = "#0f0"
                    }

                }, 10)
            };

            speechRecognizer.onresult = function() {
                comando = event.results[0][0].transcript;
                temp.style.display="block";
                //if(comando.indexOf("coma coma")>-1)
                temp.value=comando;
                ac = comando; // a.value=comando;//exComando(comando)  if (e.st)

            }
            speechRecognizer.onerror = function(event) {};


        } catch (e) {
            alert(e)
        };

    }

    function speak(e) {
        var a = e.parentNode.getElementsByTagName("textarea")[0];
        var tx = a.value;
let url = 'https://api.voicerss.org/';
let api = '3e695fb424c44aa7a4cf6f59df08ba04';//c867cf4d247144509383092e62d8dbf1
    var l=`${url}?key=${api}&hl=es-mx&v=Teresa&src=${tx}&f=48khz_16bit_stereo`;
        new Audio(l).play();

    }

    function wetNotas(){
        alert("Back it up in web");


        //http2://jsonblob.com/api/1122256995641212928
        if(li===null) prompt("There is no link, Paste your link");
        if(li===null)return;
    }
    GetJ=function(url, callback) {
            var xhr = new XMLHttpRequest()
            xhr.open('GET', url + '/1', true)
            xhr.onload = function() {
                var users = JSON.parse(xhr.responseText);
                if (xhr.readyState == 4 && xhr.status == "200") {
                    callback(users);
                } else {
                    console.error(users);
                }
            }
            xhr.send(null);
        }

         UpdateJ= function(url, ob, callback) {
            var json = JSON.stringify(ob);

            var xhr = new XMLHttpRequest();
            xhr.open("PUT", url + '/12', true);
            xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            xhr.onload = function() {
                var users = JSON.parse(xhr.responseText);
                if (xhr.readyState == 4 && xhr.status == "200") {
                    if (callback != undefined) callback(users);
                } else {
                    (users);
                }
            }
            xhr.send(json);
        }

         convert=function(txt, p) {
            var w = "";
            for (var i = 0; i < txt.length; i++) {
                w += txt[i].charCodeAt(0).toString(p) + ".";
            }
            return w.slice(0, -1);
        }

         regreso = function(str, p, callback) {
            var ae = str.split(".").map(function(elem) {
                return String.fromCharCode(parseInt(elem, p));
            }).join("");
            if (callback != undefined) callback(ae.trim());
            return ae
        }
         loadDoc=function(url, callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", url, false);
            xhttp.send();
            if (callback != undefined) callback(xhttp.responseText);
            return xhttp.responseText
        }

</script>

</html>
